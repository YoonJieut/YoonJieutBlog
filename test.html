<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>인터렉티브 클리핑 마스크</title>
    <style>
      svg {
        border: 1px solid #ccc; /* SVG 영역을 시각적으로 표시합니다. */
      }
      #mouse-rect {
        transition: all 0.3s ease-out; /* 부드러운 이동을 위한 transition 효과를 추가합니다. */
      }
    </style>
  </head>
  <body>
    <svg id="svgArea" width="150" height="200" viewBox="0 0 150 200">
      <defs>
        <clipPath id="clip-rect">
          <!-- 클리핑 패스를 정의한 rect 요소. 초기 위치는 중앙입니다. -->
          <rect id="mouse-rect" x="0" y="0" width="150" height="200" />
        </clipPath>
      </defs>
      <!-- 클리핑 패스가 적용된 이미지. href 속성으로 이미지의 URL을 지정합니다. -->
      <image
        clip-path="url(#clip-rect)"
        href="https://via.placeholder.com/150x200"
        width="150"
        height="200"
      />
    </svg>

    <script>
      const svgArea = document.getElementById("svgArea");
      const mouseRect = document.getElementById("mouse-rect");
      const rectWidth = 150; // 클리핑 rect의 너비를 설정하는 변수입니다.
      const rectHeight = 200; // 클리핑 rect의 높이를 설정하는 변수입니다.

      function moveRect(event) {
        // 마우스 포인터의 SVG 내 좌표를 계산합니다.
        const svgPoint = getSVGPoint(event);
        // 마우스 진입 방향에 따라 반대 방향으로 rect를 이동시키기 위한 로직입니다.
        const moveDistance = 5;
        const offsetX = svgPoint.x < 100 ? moveDistance : -moveDistance;
        const offsetY = svgPoint.y < 100 ? moveDistance : -moveDistance;
        // rect 요소의 위치를 업데이트합니다.
        mouseRect.setAttribute("x", offsetX);
        mouseRect.setAttribute("y", offsetY);
      }

      function resetRect() {
        // 마우스가 SVG 영역을 벗어났을 때 rect를 중앙으로 리셋합니다.
        mouseRect.setAttribute("x", 0);
        mouseRect.setAttribute("y", 0);
      }

      function getSVGPoint(event) {
        // 마우스 이벤트의 클라이언트 좌표를 SVG 좌표계로 변환합니다.
        var pt = svgArea.createSVGPoint();
        pt.x = event.clientX;
        pt.y = event.clientY;
        return pt.matrixTransform(svgArea.getScreenCTM().inverse());
      }

      // 마우스 이벤트 리스너들을 추가합니다.
      svgArea.addEventListener("mousemove", moveRect);
      svgArea.addEventListener("mouseleave", resetRect);
    </script>
  </body>
</html>
